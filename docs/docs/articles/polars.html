<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<style type="text/css">
@font-face {
font-family: octicons-link;
src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAZwABAAAAAACFQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEU0lHAAAGaAAAAAgAAAAIAAAAAUdTVUIAAAZcAAAACgAAAAoAAQAAT1MvMgAAAyQAAABJAAAAYFYEU3RjbWFwAAADcAAAAEUAAACAAJThvmN2dCAAAATkAAAABAAAAAQAAAAAZnBnbQAAA7gAAACyAAABCUM+8IhnYXNwAAAGTAAAABAAAAAQABoAI2dseWYAAAFsAAABPAAAAZwcEq9taGVhZAAAAsgAAAA0AAAANgh4a91oaGVhAAADCAAAABoAAAAkCA8DRGhtdHgAAAL8AAAADAAAAAwGAACfbG9jYQAAAsAAAAAIAAAACABiATBtYXhwAAACqAAAABgAAAAgAA8ASm5hbWUAAAToAAABQgAAAlXu73sOcG9zdAAABiwAAAAeAAAAME3QpOBwcmVwAAAEbAAAAHYAAAB/aFGpk3jaTY6xa8JAGMW/O62BDi0tJLYQincXEypYIiGJjSgHniQ6umTsUEyLm5BV6NDBP8Tpts6F0v+k/0an2i+itHDw3v2+9+DBKTzsJNnWJNTgHEy4BgG3EMI9DCEDOGEXzDADU5hBKMIgNPZqoD3SilVaXZCER3/I7AtxEJLtzzuZfI+VVkprxTlXShWKb3TBecG11rwoNlmmn1P2WYcJczl32etSpKnziC7lQyWe1smVPy/Lt7Kc+0vWY/gAgIIEqAN9we0pwKXreiMasxvabDQMM4riO+qxM2ogwDGOZTXxwxDiycQIcoYFBLj5K3EIaSctAq2kTYiw+ymhce7vwM9jSqO8JyVd5RH9gyTt2+J/yUmYlIR0s04n6+7Vm1ozezUeLEaUjhaDSuXHwVRgvLJn1tQ7xiuVv/ocTRF42mNgZGBgYGbwZOBiAAFGJBIMAAizAFoAAABiAGIAznjaY2BkYGAA4in8zwXi+W2+MjCzMIDApSwvXzC97Z4Ig8N/BxYGZgcgl52BCSQKAA3jCV8CAABfAAAAAAQAAEB42mNgZGBg4f3vACQZQABIMjKgAmYAKEgBXgAAeNpjYGY6wTiBgZWBg2kmUxoDA4MPhGZMYzBi1AHygVLYQUCaawqDA4PChxhmh/8ODDEsvAwHgMKMIDnGL0x7gJQCAwMAJd4MFwAAAHjaY2BgYGaA4DAGRgYQkAHyGMF8NgYrIM3JIAGVYYDT+AEjAwuDFpBmA9KMDEwMCh9i/v8H8sH0/4dQc1iAmAkALaUKLgAAAHjaTY9LDsIgEIbtgqHUPpDi3gPoBVyRTmTddOmqTXThEXqrob2gQ1FjwpDvfwCBdmdXC5AVKFu3e5MfNFJ29KTQT48Ob9/lqYwOGZxeUelN2U2R6+cArgtCJpauW7UQBqnFkUsjAY/kOU1cP+DAgvxwn1chZDwUbd6CFimGXwzwF6tPbFIcjEl+vvmM/byA48e6tWrKArm4ZJlCbdsrxksL1AwWn/yBSJKpYbq8AXaaTb8AAHja28jAwOC00ZrBeQNDQOWO//sdBBgYGRiYWYAEELEwMTE4uzo5Zzo5b2BxdnFOcALxNjA6b2ByTswC8jYwg0VlNuoCTWAMqNzMzsoK1rEhNqByEyerg5PMJlYuVueETKcd/89uBpnpvIEVomeHLoMsAAe1Id4AAAAAAAB42oWQT07CQBTGv0JBhagk7HQzKxca2sJCE1hDt4QF+9JOS0nbaaYDCQfwCJ7Au3AHj+LO13FMmm6cl7785vven0kBjHCBhfpYuNa5Ph1c0e2Xu3jEvWG7UdPDLZ4N92nOm+EBXuAbHmIMSRMs+4aUEd4Nd3CHD8NdvOLTsA2GL8M9PODbcL+hD7C1xoaHeLJSEao0FEW14ckxC+TU8TxvsY6X0eLPmRhry2WVioLpkrbp84LLQPGI7c6sOiUzpWIWS5GzlSgUzzLBSikOPFTOXqly7rqx0Z1Q5BAIoZBSFihQYQOOBEdkCOgXTOHA07HAGjGWiIjaPZNW13/+lm6S9FT7rLHFJ6fQbkATOG1j2OFMucKJJsxIVfQORl+9Jyda6Sl1dUYhSCm1dyClfoeDve4qMYdLEbfqHf3O/AdDumsjAAB42mNgYoAAZQYjBmyAGYQZmdhL8zLdDEydARfoAqIAAAABAAMABwAKABMAB///AA8AAQAAAAAAAAAAAAAAAAABAAAAAA==) format('woff');
}
body {
-webkit-text-size-adjust: 100%;
text-size-adjust: 100%;
color: #333;
font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
font-size: 16px;
line-height: 1.6;
word-wrap: break-word;
}
a {
background-color: transparent;
}
a:active,
a:hover {
outline: 0;
}
strong {
font-weight: bold;
}
h1 {
font-size: 2em;
margin: 0.67em 0;
}
img {
border: 0;
}
hr {
box-sizing: content-box;
height: 0;
}
pre {
overflow: auto;
}
code,
kbd,
pre {
font-family: monospace, monospace;
font-size: 1em;
}
input {
color: inherit;
font: inherit;
margin: 0;
}
html input[disabled] {
cursor: default;
}
input {
line-height: normal;
}
input[type="checkbox"] {
box-sizing: border-box;
padding: 0;
}
table {
border-collapse: collapse;
border-spacing: 0;
}
td,
th {
padding: 0;
}
* {
box-sizing: border-box;
}
input {
font: 13px / 1.4 Helvetica, arial, nimbussansl, liberationsans, freesans, clean, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}
a {
color: #4078c0;
text-decoration: none;
}
a:hover,
a:active {
text-decoration: underline;
}
hr {
height: 0;
margin: 15px 0;
overflow: hidden;
background: transparent;
border: 0;
border-bottom: 1px solid #ddd;
}
hr:before {
display: table;
content: "";
}
hr:after {
display: table;
clear: both;
content: "";
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 15px;
margin-bottom: 15px;
line-height: 1.1;
}
h1 {
font-size: 30px;
}
h2 {
font-size: 21px;
}
h3 {
font-size: 16px;
}
h4 {
font-size: 14px;
}
h5 {
font-size: 12px;
}
h6 {
font-size: 11px;
}
blockquote {
margin: 0;
}
ul,
ol {
padding: 0;
margin-top: 0;
margin-bottom: 0;
}
ol ol,
ul ol {
list-style-type: lower-roman;
}
ul ul ol,
ul ol ol,
ol ul ol,
ol ol ol {
list-style-type: lower-alpha;
}
dd {
margin-left: 0;
}
code {
font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
font-size: 12px;
}
pre {
margin-top: 0;
margin-bottom: 0;
font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}
.select::-ms-expand {
opacity: 0;
}
.octicon {
font: normal normal normal 16px/1 octicons-link;
display: inline-block;
text-decoration: none;
text-rendering: auto;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
-webkit-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
}
.octicon-link:before {
content: '\f05c';
}
.markdown-body:before {
display: table;
content: "";
}
.markdown-body:after {
display: table;
clear: both;
content: "";
}
.markdown-body>*:first-child {
margin-top: 0 !important;
}
.markdown-body>*:last-child {
margin-bottom: 0 !important;
}
a:not([href]) {
color: inherit;
text-decoration: none;
}
.anchor {
display: inline-block;
padding-right: 2px;
margin-left: -18px;
}
.anchor:focus {
outline: none;
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 1em;
margin-bottom: 16px;
font-weight: bold;
line-height: 1.4;
}
h1 .octicon-link,
h2 .octicon-link,
h3 .octicon-link,
h4 .octicon-link,
h5 .octicon-link,
h6 .octicon-link {
color: #000;
vertical-align: middle;
visibility: hidden;
}
h1:hover .anchor,
h2:hover .anchor,
h3:hover .anchor,
h4:hover .anchor,
h5:hover .anchor,
h6:hover .anchor {
text-decoration: none;
}
h1:hover .anchor .octicon-link,
h2:hover .anchor .octicon-link,
h3:hover .anchor .octicon-link,
h4:hover .anchor .octicon-link,
h5:hover .anchor .octicon-link,
h6:hover .anchor .octicon-link {
visibility: visible;
}
h1 {
padding-bottom: 0.3em;
font-size: 2.25em;
line-height: 1.2;
border-bottom: 1px solid #eee;
}
h1 .anchor {
line-height: 1;
}
h2 {
padding-bottom: 0.3em;
font-size: 1.75em;
line-height: 1.225;
border-bottom: 1px solid #eee;
}
h2 .anchor {
line-height: 1;
}
h3 {
font-size: 1.5em;
line-height: 1.43;
}
h3 .anchor {
line-height: 1.2;
}
h4 {
font-size: 1.25em;
}
h4 .anchor {
line-height: 1.2;
}
h5 {
font-size: 1em;
}
h5 .anchor {
line-height: 1.1;
}
h6 {
font-size: 1em;
color: #777;
}
h6 .anchor {
line-height: 1.1;
}
p,
blockquote,
ul,
ol,
dl,
table,
pre {
margin-top: 0;
margin-bottom: 16px;
}
hr {
height: 4px;
padding: 0;
margin: 16px 0;
background-color: #e7e7e7;
border: 0 none;
}
ul,
ol {
padding-left: 2em;
}
ul ul,
ul ol,
ol ol,
ol ul {
margin-top: 0;
margin-bottom: 0;
}
li>p {
margin-top: 16px;
}
dl {
padding: 0;
}
dl dt {
padding: 0;
margin-top: 16px;
font-size: 1em;
font-style: italic;
font-weight: bold;
}
dl dd {
padding: 0 16px;
margin-bottom: 16px;
}
blockquote {
padding: 0 15px;
color: #777;
border-left: 4px solid #ddd;
}
blockquote>:first-child {
margin-top: 0;
}
blockquote>:last-child {
margin-bottom: 0;
}
table {
display: block;
width: 100%;
overflow: auto;
word-break: normal;
word-break: keep-all;
}
table th {
font-weight: bold;
}
table th,
table td {
padding: 6px 13px;
border: 1px solid #ddd;
}
table tr {
background-color: #fff;
border-top: 1px solid #ccc;
}
table tr:nth-child(2n) {
background-color: #f8f8f8;
}
img {
max-width: 100%;
box-sizing: content-box;
background-color: #fff;
}
code {
padding: 0;
padding-top: 0.2em;
padding-bottom: 0.2em;
margin: 0;
font-size: 85%;
background-color: rgba(0,0,0,0.04);
border-radius: 3px;
}
code:before,
code:after {
letter-spacing: -0.2em;
content: "\00a0";
}
pre>code {
padding: 0;
margin: 0;
font-size: 100%;
word-break: normal;
white-space: pre;
background: transparent;
border: 0;
}
.highlight {
margin-bottom: 16px;
}
.highlight pre,
pre {
padding: 16px;
overflow: auto;
font-size: 85%;
line-height: 1.45;
background-color: #f7f7f7;
border-radius: 3px;
}
.highlight pre {
margin-bottom: 0;
word-break: normal;
}
pre {
word-wrap: normal;
}
pre code {
display: inline;
max-width: initial;
padding: 0;
margin: 0;
overflow: initial;
line-height: inherit;
word-wrap: normal;
background-color: transparent;
border: 0;
}
pre code:before,
pre code:after {
content: normal;
}
kbd {
display: inline-block;
padding: 3px 5px;
font-size: 11px;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.pl-c {
color: #969896;
}
.pl-c1,
.pl-s .pl-v {
color: #0086b3;
}
.pl-e,
.pl-en {
color: #795da3;
}
.pl-s .pl-s1,
.pl-smi {
color: #333;
}
.pl-ent {
color: #63a35c;
}
.pl-k {
color: #a71d5d;
}
.pl-pds,
.pl-s,
.pl-s .pl-pse .pl-s1,
.pl-sr,
.pl-sr .pl-cce,
.pl-sr .pl-sra,
.pl-sr .pl-sre {
color: #183691;
}
.pl-v {
color: #ed6a43;
}
.pl-id {
color: #b52a1d;
}
.pl-ii {
background-color: #b52a1d;
color: #f8f8f8;
}
.pl-sr .pl-cce {
color: #63a35c;
font-weight: bold;
}
.pl-ml {
color: #693a17;
}
.pl-mh,
.pl-mh .pl-en,
.pl-ms {
color: #1d3e81;
font-weight: bold;
}
.pl-mq {
color: #008080;
}
.pl-mi {
color: #333;
font-style: italic;
}
.pl-mb {
color: #333;
font-weight: bold;
}
.pl-md {
background-color: #ffecec;
color: #bd2c00;
}
.pl-mi1 {
background-color: #eaffea;
color: #55a532;
}
.pl-mdr {
color: #795da3;
font-weight: bold;
}
.pl-mo {
color: #1d3e81;
}
kbd {
display: inline-block;
padding: 3px 5px;
font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.task-list-item {
list-style-type: none;
}
.task-list-item+.task-list-item {
margin-top: 3px;
}
.task-list-item input {
margin: 0 0.35em 0.25em -1.6em;
vertical-align: middle;
}
:checked+.radio-label {
z-index: 1;
position: relative;
border-color: #4078c0;
}
.sourceLine {
display: inline-block;
}
code .kw { color: #000000; }
code .dt { color: #ed6a43; }
code .dv { color: #009999; }
code .bn { color: #009999; }
code .fl { color: #009999; }
code .ch { color: #009999; }
code .st { color: #183691; }
code .co { color: #969896; }
code .ot { color: #0086b3; }
code .al { color: #a61717; }
code .fu { color: #63a35c; }
code .er { color: #a61717; background-color: #e3d2d2; }
code .wa { color: #000000; }
code .cn { color: #008080; }
code .sc { color: #008080; }
code .vs { color: #183691; }
code .ss { color: #183691; }
code .im { color: #000000; }
code .va {color: #008080; }
code .cf { color: #000000; }
code .op { color: #000000; }
code .bu { color: #000000; }
code .ex { color: #000000; }
code .pp { color: #999999; }
code .at { color: #008080; }
code .do { color: #969896; }
code .an { color: #008080; }
code .cv { color: #008080; }
code .in { color: #008080; }
</style>
<style>
body {
box-sizing: border-box;
min-width: 200px;
max-width: 980px;
margin: 0 auto;
padding: 45px;
padding-top: 0px;
}
</style>


</head>

<body>

<h1 id="an-introduction-to-polars-from-r">An Introduction to Polars from
R</h1>
<h2 id="what-is-polars">What is Polars?</h2>
<p>Polars is <a href="https://duckdblabs.github.io/db-benchmark/">a
lightning fast</a> Data Frame library. Its embarrassingly parallel
execution, cache efficient algorithms and expressive API makes it
perfect for efficient data wrangling, data pipelines, snappy APIs and so
much more. Polars also supports “streaming mode” for out-of-memory
operations. This allows users to analyze datasets many times larger than
RAM.</p>
<p>The underlying computation engine is written in Rust and is built on
the Apache Arrow columnar memory format. It can be used in Rust or via
Python bindings. The <strong>polars</strong> R-package provides
equivalent bindings from R. Within R, python and rust each polars
package is just called polars. The implemention polars in the different
languages can be called rust-polars, py-polars, r-polars,
nodejs-polars…</p>
<p><strong>polars</strong> users can expect orders of magnitude(s)
improvement compared to <strong>dplyr</strong> for simple
transformations on datasets &gt;500Mb. The automatic Polars optimization
framework means that that this speed boost can be even greater for
complex queries that chain together many operations. Performance is
similar to that of <strong>data.table</strong>, although
<strong>polars</strong> supports additional functionality via its
relationship to the Apache Arrow memory model. For example, it can scan
multiple Parquet files and datasets and selectively import random
subsets without having to read all of the data.</p>
<p>Polars syntax is similar to that of Spark, but the workflow is
column-oriented rather than row-oriented. Since R is itself a
column-oriented language, this should immediately feel familiar to most
R users. Like Spark and modern SQL variants, Polars optimizes queries
for memory consumption and speed, so you don’t have to. However, unlike
Spark, Polars is natively multithreaded instead of multinoded. This
makes (r)polars much simpler to install and can be used as one would any
other R package.</p>
<p>This R port relies on the excellent <a href="https://github.com/extendr"><strong>extendr</strong></a> package,
which is the R equivalent to pyo3+maturin. <strong>extendr</strong> is
very convenient for calling Rust from R, and vice versa, and is what we
use to build the <strong>polars</strong> package. Once built, however,
<strong>polars</strong> has no other dependencies other than R itself.
This makes it very fast and lightweight to install, and so
<strong>polars</strong> can immediately be used to tackle your big (or
small!) data wrangling tasks.</p>
<h2 id="documentation-and-tutorials">Documentation and tutorials</h2>
<p>Users can find detailed documentation for all objects, functions, and
methods <a href="https://rpolars.github.io/reference/index.html">on the
Reference page of this website.</a> This documentation can also be
accessed from the R console using the typical <code>?</code> syntax. For
example, we will later use the <code>DataFrame()</code> constructor
function and apply the <code>groupby()</code> method to a
<code>DataFrame</code> object. The documentation for these can be
accessed by typing these commands:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>?DataFrame</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>?DataFrame_groupby</span></code></pre></div>
<p>The <a href="https://pola-rs.github.io/polars-book/user-guide/">Polars book</a>
offers a great introduction to the Polars data frame library, with a
very large number of examples in Python and Rust. The syntax and
expressions in the <code>polars</code> package for R are (deliberately)
as close to the Python implementation as possible, so you can always
refer to the <a href="https://pola-rs.github.io/polars-book/user-guide/">polars book</a>
for more ideas. Just remember to switch out any “.” (Python) for a “$”
(R) when chaining methods. For example, here are two equivalent lines of
code for some hypothetical dataset.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Python</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>df.group_by(<span class="st">&quot;id&quot;</span>).mean()</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># R</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>df<span class="sc">$</span><span class="fu">groupby</span>(<span class="st">&quot;id&quot;</span>)<span class="sc">$</span><span class="fu">mean</span>()</span></code></pre></div>
<h2 id="series-and-dataframes"><code>Series</code> and
<code>DataFrames</code></h2>
<p>In <code>polars</code> objects of class <code>Series</code> are
analogous to R vectors. Objects of class <code>DataFrame</code> are
analogous to R data frames. To convert R vectors and data frames to
Polars <code>Series</code> and <code>DataFrames</code>, we load the
library and use constructor functions with the <code>pl$</code> prefix.
This prefix is very important, as most of the <code>polars</code>
functions are made available via <code>pl$</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">library</span>(polars)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>ser <span class="ot">=</span> pl<span class="sc">$</span><span class="fu">Series</span>((<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">*</span> <span class="dv">5</span>)</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>ser</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt; polars Series: shape: (5,)</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt; Series: &#39;&#39; [f64]</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt; [</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt;  5.0</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt;  10.0</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt;  15.0</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt;  20.0</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt;  25.0</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt; ]</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>dat <span class="ot">=</span> pl<span class="sc">$</span><span class="fu">DataFrame</span>(mtcars)</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>dat</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co">#&gt; polars DataFrame: shape: (32, 11)</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co">#&gt; ┌──────┬─────┬───────┬───────┬─────┬─────┬─────┬──────┬──────┐</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ cyl ┆ disp  ┆ hp    ┆ ... ┆ vs  ┆ am  ┆ gear ┆ carb │</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ --- ┆ ---   ┆ ---   ┆     ┆ --- ┆ --- ┆ ---  ┆ ---  │</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64 ┆ f64   ┆ f64   ┆     ┆ f64 ┆ f64 ┆ f64  ┆ f64  │</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═════╪═══════╪═══════╪═════╪═════╪═════╪══════╪══════╡</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ ... ┆ 0.0 ┆ 1.0 ┆ 4.0  ┆ 4.0  │</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ ... ┆ 0.0 ┆ 1.0 ┆ 4.0  ┆ 4.0  │</span></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a><span class="co">#&gt; │ 22.8 ┆ 4.0 ┆ 108.0 ┆ 93.0  ┆ ... ┆ 1.0 ┆ 1.0 ┆ 4.0  ┆ 1.0  │</span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 6.0 ┆ 258.0 ┆ 110.0 ┆ ... ┆ 1.0 ┆ 0.0 ┆ 3.0  ┆ 1.0  │</span></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a><span class="co">#&gt; │ ...  ┆ ... ┆ ...   ┆ ...   ┆ ... ┆ ... ┆ ... ┆ ...  ┆ ...  │</span></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a><span class="co">#&gt; │ 15.8 ┆ 8.0 ┆ 351.0 ┆ 264.0 ┆ ... ┆ 0.0 ┆ 1.0 ┆ 5.0  ┆ 4.0  │</span></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a><span class="co">#&gt; │ 19.7 ┆ 6.0 ┆ 145.0 ┆ 175.0 ┆ ... ┆ 0.0 ┆ 1.0 ┆ 5.0  ┆ 6.0  │</span></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a><span class="co">#&gt; │ 15.0 ┆ 8.0 ┆ 301.0 ┆ 335.0 ┆ ... ┆ 0.0 ┆ 1.0 ┆ 5.0  ┆ 8.0  │</span></span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 4.0 ┆ 121.0 ┆ 109.0 ┆ ... ┆ 1.0 ┆ 1.0 ┆ 4.0  ┆ 2.0  │</span></span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a><span class="co">#&gt; └──────┴─────┴───────┴───────┴─────┴─────┴─────┴──────┴──────┘</span></span></code></pre></div>
<p>Both Polars and R are column-orientated. So you can think of
<code>DataFrames</code> (data.frames) as being made up of a collection
of <code>Series</code> (vectors). In fact, you can create a new Polars
<code>DataFrame</code> as a mix of <code>Series</code> and/or regular R
vectors.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>pl<span class="sc">$</span><span class="fu">DataFrame</span>(</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="at">a =</span> pl<span class="sc">$</span><span class="fu">Series</span>((<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">*</span> <span class="dv">5</span>),</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="at">b =</span> pl<span class="sc">$</span><span class="fu">Series</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]),</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="at">c =</span> pl<span class="sc">$</span><span class="fu">Series</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)),</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="at">d =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">14</span>, <span class="dv">13</span>, <span class="dv">12</span>, <span class="dv">11</span>),</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>)</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; polars DataFrame: shape: (5, 6)</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt; ┌──────┬─────┬─────┬──────┬────────────┬──────────────┐</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt; │ a    ┆ b   ┆ c   ┆ d    ┆ new_column ┆ new_column_1 │</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ --- ┆ --- ┆ ---  ┆ ---        ┆ ---          │</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ str ┆ f64 ┆ f64  ┆ f64        ┆ i32          │</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═════╪═════╪══════╪════════════╪══════════════╡</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt; │ 5.0  ┆ a   ┆ 1.0 ┆ 15.0 ┆ 5.0        ┆ 1            │</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt; │ 10.0 ┆ b   ┆ 2.0 ┆ 14.0 ┆ 4.0        ┆ 2            │</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#&gt; │ 15.0 ┆ c   ┆ 3.0 ┆ 13.0 ┆ 3.0        ┆ 3            │</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">#&gt; │ 20.0 ┆ d   ┆ 4.0 ┆ 12.0 ┆ 2.0        ┆ 4            │</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="co">#&gt; │ 25.0 ┆ e   ┆ 5.0 ┆ 11.0 ┆ 1.0        ┆ 5            │</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co">#&gt; └──────┴─────┴─────┴──────┴────────────┴──────────────┘</span></span></code></pre></div>
<p><code>Series</code> and <code>DataFrame</code> can be operated on
using many standard R functions. For example:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Series</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">length</span>(ser)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt; [1] 5</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="fu">max</span>(ser)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt; polars Series: shape: (1,)</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt; Series: &#39;&#39; [f64]</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt; [</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt;  25.0</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt; ]</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co"># DataFrame</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="fu">names</span>(dat)</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;mpg&quot;  &quot;cyl&quot;  &quot;disp&quot; &quot;hp&quot;   &quot;drat&quot; &quot;wt&quot;   &quot;qsec&quot; &quot;vs&quot;   &quot;am&quot;   &quot;gear&quot; &quot;carb&quot;</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="fu">dim</span>(dat)</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="co">#&gt; [1] 32 11</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="fu">head</span>(dat, <span class="at">n =</span> <span class="dv">2</span>)</span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a><span class="co">#&gt; polars DataFrame: shape: (2, 11)</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a><span class="co">#&gt; ┌──────┬─────┬───────┬───────┬─────┬─────┬─────┬──────┬──────┐</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ cyl ┆ disp  ┆ hp    ┆ ... ┆ vs  ┆ am  ┆ gear ┆ carb │</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ --- ┆ ---   ┆ ---   ┆     ┆ --- ┆ --- ┆ ---  ┆ ---  │</span></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64 ┆ f64   ┆ f64   ┆     ┆ f64 ┆ f64 ┆ f64  ┆ f64  │</span></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═════╪═══════╪═══════╪═════╪═════╪═════╪══════╪══════╡</span></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ ... ┆ 0.0 ┆ 1.0 ┆ 4.0  ┆ 4.0  │</span></span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ ... ┆ 0.0 ┆ 1.0 ┆ 4.0  ┆ 4.0  │</span></span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a><span class="co">#&gt; └──────┴─────┴───────┴───────┴─────┴─────┴─────┴──────┴──────┘</span></span></code></pre></div>
<h2 id="methods-and-pipelines">Methods and pipelines</h2>
<p>Although some simple R functions work out of the box on
<strong>polars</strong> objects, the full power of Polars is realized
via <em>methods</em>. Polars methods are accessed using the
<code>$</code> syntax. For example, to convert Polars
<code>Series</code> and <code>DataFrames</code> back to standard R
objects, we use the <code>$to_r_vector()</code> and
<code>$as_data_frame()</code> methods:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>ser<span class="sc">$</span><span class="fu">to_r_vector</span>()</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co">#&gt; [1]  5 10 15 20 25</span></span></code></pre></div>
<p>There are numerous methods designed to accomplish various tasks:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>ser<span class="sc">$</span><span class="fu">max</span>()</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">#&gt; polars Series: shape: (1,)</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#&gt; Series: &#39;&#39; [f64]</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt; [</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt;  25.0</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt; ]</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">slice</span>(<span class="at">offset =</span> <span class="dv">2</span>, <span class="at">length =</span> <span class="dv">3</span>)  </span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt; polars DataFrame: shape: (3, 11)</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; ┌──────┬─────┬───────┬───────┬─────┬─────┬─────┬──────┬──────┐</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ cyl ┆ disp  ┆ hp    ┆ ... ┆ vs  ┆ am  ┆ gear ┆ carb │</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ --- ┆ ---   ┆ ---   ┆     ┆ --- ┆ --- ┆ ---  ┆ ---  │</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64 ┆ f64   ┆ f64   ┆     ┆ f64 ┆ f64 ┆ f64  ┆ f64  │</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═════╪═══════╪═══════╪═════╪═════╪═════╪══════╪══════╡</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt; │ 22.8 ┆ 4.0 ┆ 108.0 ┆ 93.0  ┆ ... ┆ 1.0 ┆ 1.0 ┆ 4.0  ┆ 1.0  │</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 6.0 ┆ 258.0 ┆ 110.0 ┆ ... ┆ 1.0 ┆ 0.0 ┆ 3.0  ┆ 1.0  │</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co">#&gt; │ 18.7 ┆ 8.0 ┆ 360.0 ┆ 175.0 ┆ ... ┆ 0.0 ┆ 0.0 ┆ 3.0  ┆ 2.0  │</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co">#&gt; └──────┴─────┴───────┴───────┴─────┴─────┴─────┴──────┴──────┘</span></span></code></pre></div>
<p>One advantage of using methods is that many more operations are
possible on Polars objects using methods than through base R
functions.</p>
<p>A second advantage is <em>Methods Chaining</em>, a core part of the
Polars workflow. If you are coming from one of the other popular data
wrangling libraries in R, then you probably already have an innate sense
of what this means. For instance,</p>
<ul>
<li>In <strong>dplyr</strong> we use a pipe operator,
e.g. <code>dat |&gt; filter(...) |&gt; select(...)</code></li>
<li>In <strong>data.table</strong> we use its indexing syntax,
e.g. <code>DT[i, j, by][...]</code></li>
<li>Etc.</li>
</ul>
<p>In <strong>polars</strong> our method chaining syntax takes the form
<code>object$m1()$m2()</code>, where <code>object</code> is our data
object, and <code>m1()</code> and <code>m2()</code> are appropriate <a href="https://rpolars.github.io/reference/index.html">methods</a>, like
subsetting or aggregation expressions.</p>
<p>This might all seem a little abstract, so let’s walk through some
quick examples to help make things concrete. We use the
<code>mtcars</code> dataset that we coerced to a <code>DataFrame</code>
in introduction.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> We use the <code>$max</code> method to
compute the maximum value in each column:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">max</span>()</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co">#&gt; polars DataFrame: shape: (1, 11)</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt; ┌──────┬─────┬───────┬───────┬─────┬─────┬─────┬──────┬──────┐</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ cyl ┆ disp  ┆ hp    ┆ ... ┆ vs  ┆ am  ┆ gear ┆ carb │</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ --- ┆ ---   ┆ ---   ┆     ┆ --- ┆ --- ┆ ---  ┆ ---  │</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64 ┆ f64   ┆ f64   ┆     ┆ f64 ┆ f64 ┆ f64  ┆ f64  │</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═════╪═══════╪═══════╪═════╪═════╪═════╪══════╪══════╡</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt; │ 33.9 ┆ 8.0 ┆ 472.0 ┆ 335.0 ┆ ... ┆ 1.0 ┆ 1.0 ┆ 5.0  ┆ 8.0  │</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt; └──────┴─────┴───────┴───────┴─────┴─────┴─────┴──────┴──────┘</span></span></code></pre></div>
<p>Now, we first use the <code>$tail</code> method to select the last 10
rows of the dataset, and then use the <code>$max</code> method to
compute the maximums in those 10 rows:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">tail</span>(<span class="dv">10</span>)<span class="sc">$</span><span class="fu">max</span>()</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="co">#&gt; polars DataFrame: shape: (1, 11)</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co">#&gt; ┌──────┬─────┬───────┬───────┬─────┬─────┬─────┬──────┬──────┐</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ cyl ┆ disp  ┆ hp    ┆ ... ┆ vs  ┆ am  ┆ gear ┆ carb │</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ --- ┆ ---   ┆ ---   ┆     ┆ --- ┆ --- ┆ ---  ┆ ---  │</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64 ┆ f64   ┆ f64   ┆     ┆ f64 ┆ f64 ┆ f64  ┆ f64  │</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═════╪═══════╪═══════╪═════╪═════╪═════╪══════╪══════╡</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; │ 30.4 ┆ 8.0 ┆ 400.0 ┆ 335.0 ┆ ... ┆ 1.0 ┆ 1.0 ┆ 5.0  ┆ 8.0  │</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt; └──────┴─────┴───────┴───────┴─────┴─────┴─────┴──────┴──────┘</span></span></code></pre></div>
<p>Finally, we convert the result to a standard R data frame:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">tail</span>(<span class="dv">10</span>)<span class="sc">$</span><span class="fu">max</span>()<span class="sc">$</span><span class="fu">as_data_frame</span>()</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co">#&gt;    mpg cyl disp  hp drat    wt qsec vs am gear carb</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#&gt; 1 30.4   8  400 335 4.43 3.845 18.9  1  1    5    8</span></span></code></pre></div>
<p>Below, we will introduce several other methods, including
<code>$select</code>, <code>$filter</code>, and <code>$groupby</code>
which allow us to do powerful data manipulations easily. To give you a
small taste, we now take group-wise means:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">groupby</span>(<span class="st">&quot;cyl&quot;</span>)<span class="sc">$</span><span class="fu">mean</span>()</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co">#&gt; polars DataFrame: shape: (3, 11)</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co">#&gt; ┌─────┬───────────┬────────────┬────────────┬─────┬──────────┬──────────┬──────────┬──────────┐</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co">#&gt; │ cyl ┆ mpg       ┆ disp       ┆ hp         ┆ ... ┆ vs       ┆ am       ┆ gear     ┆ carb     │</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co">#&gt; │ --- ┆ ---       ┆ ---        ┆ ---        ┆     ┆ ---      ┆ ---      ┆ ---      ┆ ---      │</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co">#&gt; │ f64 ┆ f64       ┆ f64        ┆ f64        ┆     ┆ f64      ┆ f64      ┆ f64      ┆ f64      │</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#&gt; ╞═════╪═══════════╪════════════╪════════════╪═════╪══════════╪══════════╪══════════╪══════════╡</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#&gt; │ 4.0 ┆ 26.663636 ┆ 105.136364 ┆ 82.636364  ┆ ... ┆ 0.909091 ┆ 0.727273 ┆ 4.090909 ┆ 1.545455 │</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#&gt; │ 6.0 ┆ 19.742857 ┆ 183.314286 ┆ 122.285714 ┆ ... ┆ 0.571429 ┆ 0.428571 ┆ 3.857143 ┆ 3.428571 │</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#&gt; │ 8.0 ┆ 15.1      ┆ 353.1      ┆ 209.214286 ┆ ... ┆ 0.0      ┆ 0.142857 ┆ 3.285714 ┆ 3.5      │</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#&gt; └─────┴───────────┴────────────┴────────────┴─────┴──────────┴──────────┴──────────┴──────────┘</span></span></code></pre></div>
<h2 id="select-columns-and-filter-rows"><code>select</code> columns and
<code>filter</code> rows</h2>
<p>We can now start chaining together various methods (expressions) to
manipulate it in different ways. For example, we can subset the data by
rows (<a href="https://rpolars.github.io/reference/filter-open-paren-close-paren.html"><code>filter()</code></a>)
and also columns (<a href="https://rpolars.github.io/reference/DataFrame_select.html"><code>select()</code></a>):</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">filter</span>(pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;cyl&quot;</span>) <span class="sc">==</span> <span class="dv">6</span>)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co">#&gt; polars DataFrame: shape: (7, 11)</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">#&gt; ┌──────┬─────┬───────┬───────┬─────┬─────┬─────┬──────┬──────┐</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ cyl ┆ disp  ┆ hp    ┆ ... ┆ vs  ┆ am  ┆ gear ┆ carb │</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ --- ┆ ---   ┆ ---   ┆     ┆ --- ┆ --- ┆ ---  ┆ ---  │</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64 ┆ f64   ┆ f64   ┆     ┆ f64 ┆ f64 ┆ f64  ┆ f64  │</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═════╪═══════╪═══════╪═════╪═════╪═════╪══════╪══════╡</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ ... ┆ 0.0 ┆ 1.0 ┆ 4.0  ┆ 4.0  │</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ ... ┆ 0.0 ┆ 1.0 ┆ 4.0  ┆ 4.0  │</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 6.0 ┆ 258.0 ┆ 110.0 ┆ ... ┆ 1.0 ┆ 0.0 ┆ 3.0  ┆ 1.0  │</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="co">#&gt; │ 18.1 ┆ 6.0 ┆ 225.0 ┆ 105.0 ┆ ... ┆ 1.0 ┆ 0.0 ┆ 3.0  ┆ 1.0  │</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="co">#&gt; │ 19.2 ┆ 6.0 ┆ 167.6 ┆ 123.0 ┆ ... ┆ 1.0 ┆ 0.0 ┆ 4.0  ┆ 4.0  │</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="co">#&gt; │ 17.8 ┆ 6.0 ┆ 167.6 ┆ 123.0 ┆ ... ┆ 1.0 ┆ 0.0 ┆ 4.0  ┆ 4.0  │</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="co">#&gt; │ 19.7 ┆ 6.0 ┆ 145.0 ┆ 175.0 ┆ ... ┆ 0.0 ┆ 1.0 ┆ 5.0  ┆ 6.0  │</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="co">#&gt; └──────┴─────┴───────┴───────┴─────┴─────┴─────┴──────┴──────┘</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">filter</span>(pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;cyl&quot;</span>) <span class="sc">==</span> <span class="dv">6</span> <span class="sc">&amp;</span> pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;am&quot;</span>) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a><span class="co">#&gt; polars DataFrame: shape: (3, 11)</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a><span class="co">#&gt; ┌──────┬─────┬───────┬───────┬─────┬─────┬─────┬──────┬──────┐</span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ cyl ┆ disp  ┆ hp    ┆ ... ┆ vs  ┆ am  ┆ gear ┆ carb │</span></span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ --- ┆ ---   ┆ ---   ┆     ┆ --- ┆ --- ┆ ---  ┆ ---  │</span></span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64 ┆ f64   ┆ f64   ┆     ┆ f64 ┆ f64 ┆ f64  ┆ f64  │</span></span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═════╪═══════╪═══════╪═════╪═════╪═════╪══════╪══════╡</span></span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ ... ┆ 0.0 ┆ 1.0 ┆ 4.0  ┆ 4.0  │</span></span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ ... ┆ 0.0 ┆ 1.0 ┆ 4.0  ┆ 4.0  │</span></span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a><span class="co">#&gt; │ 19.7 ┆ 6.0 ┆ 145.0 ┆ 175.0 ┆ ... ┆ 0.0 ┆ 1.0 ┆ 5.0  ┆ 6.0  │</span></span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a><span class="co">#&gt; └──────┴─────┴───────┴───────┴─────┴─────┴─────┴──────┴──────┘</span></span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">select</span>(pl<span class="sc">$</span><span class="fu">col</span>(<span class="fu">c</span>(<span class="st">&quot;mpg&quot;</span>, <span class="st">&quot;hp&quot;</span>)))</span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a><span class="co">#&gt; polars DataFrame: shape: (32, 2)</span></span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a><span class="co">#&gt; ┌──────┬───────┐</span></span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ hp    │</span></span>
<span id="cb13-33"><a href="#cb13-33" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ ---   │</span></span>
<span id="cb13-34"><a href="#cb13-34" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64   │</span></span>
<span id="cb13-35"><a href="#cb13-35" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═══════╡</span></span>
<span id="cb13-36"><a href="#cb13-36" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 110.0 │</span></span>
<span id="cb13-37"><a href="#cb13-37" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 110.0 │</span></span>
<span id="cb13-38"><a href="#cb13-38" tabindex="-1"></a><span class="co">#&gt; │ 22.8 ┆ 93.0  │</span></span>
<span id="cb13-39"><a href="#cb13-39" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 110.0 │</span></span>
<span id="cb13-40"><a href="#cb13-40" tabindex="-1"></a><span class="co">#&gt; │ ...  ┆ ...   │</span></span>
<span id="cb13-41"><a href="#cb13-41" tabindex="-1"></a><span class="co">#&gt; │ 15.8 ┆ 264.0 │</span></span>
<span id="cb13-42"><a href="#cb13-42" tabindex="-1"></a><span class="co">#&gt; │ 19.7 ┆ 175.0 │</span></span>
<span id="cb13-43"><a href="#cb13-43" tabindex="-1"></a><span class="co">#&gt; │ 15.0 ┆ 335.0 │</span></span>
<span id="cb13-44"><a href="#cb13-44" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 109.0 │</span></span>
<span id="cb13-45"><a href="#cb13-45" tabindex="-1"></a><span class="co">#&gt; └──────┴───────┘</span></span></code></pre></div>
<p>Of course, we can chain those methods to create a pipeline:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">filter</span>(</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;cyl&quot;</span>) <span class="sc">==</span> <span class="dv">6</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>)<span class="sc">$</span><span class="fu">select</span>(</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="fu">c</span>(<span class="st">&quot;mpg&quot;</span>, <span class="st">&quot;hp&quot;</span>, <span class="st">&quot;cyl&quot;</span>))</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co">#&gt; polars DataFrame: shape: (7, 3)</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co">#&gt; ┌──────┬───────┬─────┐</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ hp    ┆ cyl │</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ ---   ┆ --- │</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64   ┆ f64 │</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═══════╪═════╡</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 110.0 ┆ 6.0 │</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 110.0 ┆ 6.0 │</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 110.0 ┆ 6.0 │</span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a><span class="co">#&gt; │ 18.1 ┆ 105.0 ┆ 6.0 │</span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a><span class="co">#&gt; │ 19.2 ┆ 123.0 ┆ 6.0 │</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a><span class="co">#&gt; │ 17.8 ┆ 123.0 ┆ 6.0 │</span></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a><span class="co">#&gt; │ 19.7 ┆ 175.0 ┆ 6.0 │</span></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a><span class="co">#&gt; └──────┴───────┴─────┘</span></span></code></pre></div>
<h2 id="aggregations-and-modifications">Aggregations and
modifications</h2>
<p>The <code>select()</code> method that we introduced above also
supports data modification, so you can simultaneously transform it while
you are subsetting. However, the result will exclude any columns that
weren’t specified as part of the expression. To modify or add some
columns—whilst preserving all others in the dataset—it is therefore
better to use the <a href="https://rpolars.github.io/reference/DataFrame_with_columns.html"><code>with_columns()</code></a>
method. This next code chunk is equivalent to
<code>mtcars |&gt; dplyr::mutate(sum_mpg=sum(mpg), sum_hp=sum(hp), .by = cyl)</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># Add the grouped sums of some selected columns.</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">with_columns</span>(</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;mpg&quot;</span>)<span class="sc">$</span><span class="fu">sum</span>()<span class="sc">$</span><span class="fu">over</span>(<span class="st">&quot;cyl&quot;</span>)<span class="sc">$</span><span class="fu">alias</span>(<span class="st">&quot;sum_mpg&quot;</span>),</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;hp&quot;</span>)<span class="sc">$</span><span class="fu">sum</span>()<span class="sc">$</span><span class="fu">over</span>(<span class="st">&quot;cyl&quot;</span>)<span class="sc">$</span><span class="fu">alias</span>(<span class="st">&quot;sum_hp&quot;</span>)</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>)</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">#&gt; polars DataFrame: shape: (32, 13)</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co">#&gt; ┌──────┬─────┬───────┬───────┬─────┬──────┬──────┬─────────┬────────┐</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ cyl ┆ disp  ┆ hp    ┆ ... ┆ gear ┆ carb ┆ sum_mpg ┆ sum_hp │</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ --- ┆ ---   ┆ ---   ┆     ┆ ---  ┆ ---  ┆ ---     ┆ ---    │</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64 ┆ f64   ┆ f64   ┆     ┆ f64  ┆ f64  ┆ f64     ┆ f64    │</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═════╪═══════╪═══════╪═════╪══════╪══════╪═════════╪════════╡</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ ... ┆ 4.0  ┆ 4.0  ┆ 138.2   ┆ 856.0  │</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ ... ┆ 4.0  ┆ 4.0  ┆ 138.2   ┆ 856.0  │</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="co">#&gt; │ 22.8 ┆ 4.0 ┆ 108.0 ┆ 93.0  ┆ ... ┆ 4.0  ┆ 1.0  ┆ 293.3   ┆ 909.0  │</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 6.0 ┆ 258.0 ┆ 110.0 ┆ ... ┆ 3.0  ┆ 1.0  ┆ 138.2   ┆ 856.0  │</span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="co">#&gt; │ ...  ┆ ... ┆ ...   ┆ ...   ┆ ... ┆ ...  ┆ ...  ┆ ...     ┆ ...    │</span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a><span class="co">#&gt; │ 15.8 ┆ 8.0 ┆ 351.0 ┆ 264.0 ┆ ... ┆ 5.0  ┆ 4.0  ┆ 211.4   ┆ 2929.0 │</span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a><span class="co">#&gt; │ 19.7 ┆ 6.0 ┆ 145.0 ┆ 175.0 ┆ ... ┆ 5.0  ┆ 6.0  ┆ 138.2   ┆ 856.0  │</span></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a><span class="co">#&gt; │ 15.0 ┆ 8.0 ┆ 301.0 ┆ 335.0 ┆ ... ┆ 5.0  ┆ 8.0  ┆ 211.4   ┆ 2929.0 │</span></span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 4.0 ┆ 121.0 ┆ 109.0 ┆ ... ┆ 4.0  ┆ 2.0  ┆ 293.3   ┆ 909.0  │</span></span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a><span class="co">#&gt; └──────┴─────┴───────┴───────┴─────┴──────┴──────┴─────────┴────────┘</span></span></code></pre></div>
<p>For what it’s worth, the previous query could have been written more
concisely as:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">with_columns</span>(</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="fu">c</span>(<span class="st">&quot;mpg&quot;</span>, <span class="st">&quot;hp&quot;</span>))<span class="sc">$</span><span class="fu">sum</span>()<span class="sc">$</span><span class="fu">over</span>(<span class="st">&quot;cyl&quot;</span>)<span class="sc">$</span><span class="fu">prefix</span>(<span class="st">&quot;sum_&quot;</span>)</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>)</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co">#&gt; polars DataFrame: shape: (32, 13)</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co">#&gt; ┌──────┬─────┬───────┬───────┬─────┬──────┬──────┬─────────┬────────┐</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ cyl ┆ disp  ┆ hp    ┆ ... ┆ gear ┆ carb ┆ sum_mpg ┆ sum_hp │</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ --- ┆ ---   ┆ ---   ┆     ┆ ---  ┆ ---  ┆ ---     ┆ ---    │</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64 ┆ f64   ┆ f64   ┆     ┆ f64  ┆ f64  ┆ f64     ┆ f64    │</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═════╪═══════╪═══════╪═════╪══════╪══════╪═════════╪════════╡</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ ... ┆ 4.0  ┆ 4.0  ┆ 138.2   ┆ 856.0  │</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ ... ┆ 4.0  ┆ 4.0  ┆ 138.2   ┆ 856.0  │</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="co">#&gt; │ 22.8 ┆ 4.0 ┆ 108.0 ┆ 93.0  ┆ ... ┆ 4.0  ┆ 1.0  ┆ 293.3   ┆ 909.0  │</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 6.0 ┆ 258.0 ┆ 110.0 ┆ ... ┆ 3.0  ┆ 1.0  ┆ 138.2   ┆ 856.0  │</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="co">#&gt; │ ...  ┆ ... ┆ ...   ┆ ...   ┆ ... ┆ ...  ┆ ...  ┆ ...     ┆ ...    │</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="co">#&gt; │ 15.8 ┆ 8.0 ┆ 351.0 ┆ 264.0 ┆ ... ┆ 5.0  ┆ 4.0  ┆ 211.4   ┆ 2929.0 │</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="co">#&gt; │ 19.7 ┆ 6.0 ┆ 145.0 ┆ 175.0 ┆ ... ┆ 5.0  ┆ 6.0  ┆ 138.2   ┆ 856.0  │</span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a><span class="co">#&gt; │ 15.0 ┆ 8.0 ┆ 301.0 ┆ 335.0 ┆ ... ┆ 5.0  ┆ 8.0  ┆ 211.4   ┆ 2929.0 │</span></span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 4.0 ┆ 121.0 ┆ 109.0 ┆ ... ┆ 4.0  ┆ 2.0  ┆ 293.3   ┆ 909.0  │</span></span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a><span class="co">#&gt; └──────┴─────┴───────┴───────┴─────┴──────┴──────┴─────────┴────────┘</span></span></code></pre></div>
<p>Similarly, here’s how we could have aggregated (i.e., collapsed) the
dataset by groups instead of modifying them. We need simply invoke the
<code>groupby()</code> and <a href="https://rpolars.github.io/reference/Expr_agg_groups.html"><code>agg()</code></a>
methods.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">groupby</span>(</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  <span class="st">&quot;cyl&quot;</span>,</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  <span class="at">maintain_order =</span> <span class="cn">TRUE</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>)<span class="sc">$</span><span class="fu">agg</span>(</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="fu">c</span>(<span class="st">&quot;mpg&quot;</span>, <span class="st">&quot;hp&quot;</span>))<span class="sc">$</span><span class="fu">sum</span>()</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>)</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="co">#&gt; polars DataFrame: shape: (3, 3)</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="co">#&gt; ┌─────┬───────┬────────┐</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="co">#&gt; │ cyl ┆ mpg   ┆ hp     │</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="co">#&gt; │ --- ┆ ---   ┆ ---    │</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="co">#&gt; │ f64 ┆ f64   ┆ f64    │</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="co">#&gt; ╞═════╪═══════╪════════╡</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="co">#&gt; │ 6.0 ┆ 138.2 ┆ 856.0  │</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="co">#&gt; │ 4.0 ┆ 293.3 ┆ 909.0  │</span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="co">#&gt; │ 8.0 ┆ 211.4 ┆ 2929.0 │</span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="co">#&gt; └─────┴───────┴────────┘</span></span></code></pre></div>
<p>(arg <code>maintain_order = TRUE</code> is optional, since
<strong>polars</strong> doesn’t sort the results of grouped operations
by default. This is similar to what <strong>data.table</strong> does and
is also true for newer versions of <strong>dplyr</strong>.)</p>
<p>The same principles of method chaining can be combined very flexibly
to group by multiple variables and aggregation types.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">groupby</span>(</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="st">&quot;cyl&quot;</span>,</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;am&quot;</span>)<span class="sc">$</span><span class="fu">cast</span>(pl<span class="sc">$</span>Boolean)<span class="sc">$</span><span class="fu">alias</span>(<span class="st">&quot;manual&quot;</span>)</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>)<span class="sc">$</span><span class="fu">agg</span>(</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;mpg&quot;</span>)<span class="sc">$</span><span class="fu">mean</span>()<span class="sc">$</span><span class="fu">alias</span>(<span class="st">&quot;mean_mpg&quot;</span>),</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;hp&quot;</span>)<span class="sc">$</span><span class="fu">median</span>()<span class="sc">$</span><span class="fu">alias</span>(<span class="st">&quot;med_hp&quot;</span>)</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>)</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="co">#&gt; polars DataFrame: shape: (6, 4)</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="co">#&gt; ┌─────┬────────┬───────────┬────────┐</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a><span class="co">#&gt; │ cyl ┆ manual ┆ mean_mpg  ┆ med_hp │</span></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a><span class="co">#&gt; │ --- ┆ ---    ┆ ---       ┆ ---    │</span></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a><span class="co">#&gt; │ f64 ┆ bool   ┆ f64       ┆ f64    │</span></span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a><span class="co">#&gt; ╞═════╪════════╪═══════════╪════════╡</span></span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a><span class="co">#&gt; │ 6.0 ┆ false  ┆ 19.125    ┆ 116.5  │</span></span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a><span class="co">#&gt; │ 8.0 ┆ false  ┆ 15.05     ┆ 180.0  │</span></span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a><span class="co">#&gt; │ 4.0 ┆ false  ┆ 22.9      ┆ 95.0   │</span></span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a><span class="co">#&gt; │ 6.0 ┆ true   ┆ 20.566667 ┆ 110.0  │</span></span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a><span class="co">#&gt; │ 4.0 ┆ true   ┆ 28.075    ┆ 78.5   │</span></span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a><span class="co">#&gt; │ 8.0 ┆ true   ┆ 15.4      ┆ 299.5  │</span></span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a><span class="co">#&gt; └─────┴────────┴───────────┴────────┘</span></span></code></pre></div>
<p>Note that we used the <code>cast</code> method to convert the data
type of the <code>am</code> column. See the section below for more
details on data types.</p>
<h2 id="join">Join</h2>
<p>As a final example of how <strong>polars</strong> can be used for
standard data wrangling tasks, let’s implement a (left) join. For this
example, we’ll borrow some datasets from the
<strong>nycflights13</strong> package.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;flights&quot;</span>, <span class="st">&quot;planes&quot;</span>, <span class="at">package =</span> <span class="st">&quot;nycflights13&quot;</span>)</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>flights <span class="ot">=</span> pl<span class="sc">$</span><span class="fu">DataFrame</span>(flights)</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>planes <span class="ot">=</span> pl<span class="sc">$</span><span class="fu">DataFrame</span>(planes)</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>flights<span class="sc">$</span><span class="fu">join</span>(</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>  planes, </span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>  <span class="at">on =</span> <span class="st">&quot;tailnum&quot;</span>, </span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>  <span class="at">how =</span> <span class="st">&quot;left&quot;</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>)</span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="co">#&gt; polars DataFrame: shape: (336776, 27)</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="co">#&gt; ┌──────┬───────┬─────┬──────────┬─────┬─────────┬───────┬───────┬───────────┐</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="co">#&gt; │ year ┆ month ┆ day ┆ dep_time ┆ ... ┆ engines ┆ seats ┆ speed ┆ engine    │</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ ---   ┆ --- ┆ ---      ┆     ┆ ---     ┆ ---   ┆ ---   ┆ ---       │</span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a><span class="co">#&gt; │ i32  ┆ i32   ┆ i32 ┆ i32      ┆     ┆ i32     ┆ i32   ┆ i32   ┆ str       │</span></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═══════╪═════╪══════════╪═════╪═════════╪═══════╪═══════╪═══════════╡</span></span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a><span class="co">#&gt; │ 2013 ┆ 1     ┆ 1   ┆ 517      ┆ ... ┆ 2       ┆ 149   ┆ null  ┆ Turbo-fan │</span></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a><span class="co">#&gt; │ 2013 ┆ 1     ┆ 1   ┆ 533      ┆ ... ┆ 2       ┆ 149   ┆ null  ┆ Turbo-fan │</span></span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a><span class="co">#&gt; │ 2013 ┆ 1     ┆ 1   ┆ 542      ┆ ... ┆ 2       ┆ 178   ┆ null  ┆ Turbo-fan │</span></span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a><span class="co">#&gt; │ 2013 ┆ 1     ┆ 1   ┆ 544      ┆ ... ┆ 2       ┆ 200   ┆ null  ┆ Turbo-fan │</span></span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a><span class="co">#&gt; │ ...  ┆ ...   ┆ ... ┆ ...      ┆ ... ┆ ...     ┆ ...   ┆ ...   ┆ ...       │</span></span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a><span class="co">#&gt; │ 2013 ┆ 9     ┆ 30  ┆ null     ┆ ... ┆ null    ┆ null  ┆ null  ┆ null      │</span></span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a><span class="co">#&gt; │ 2013 ┆ 9     ┆ 30  ┆ null     ┆ ... ┆ null    ┆ null  ┆ null  ┆ null      │</span></span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a><span class="co">#&gt; │ 2013 ┆ 9     ┆ 30  ┆ null     ┆ ... ┆ null    ┆ null  ┆ null  ┆ null      │</span></span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a><span class="co">#&gt; │ 2013 ┆ 9     ┆ 30  ┆ null     ┆ ... ┆ null    ┆ null  ┆ null  ┆ null      │</span></span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a><span class="co">#&gt; └──────┴───────┴─────┴──────────┴─────┴─────────┴───────┴───────┴───────────┘</span></span></code></pre></div>
<p>More information on the <strong>polars</strong> joining method can be
found in the <a href="https://rpolars.github.io/reference/DataFrame_join.html">reference
manual</a>.</p>
<p>The package supports many other data manipulation operations, which
we won’t cover here. Hopefully, you will already have a sense of the key
syntax features. We now turn to another core idea of the Polars
ecosystem: <em>lazy execution</em>.</p>
<h2 id="lazy-execution">Lazy execution</h2>
<p>While the “eager” execution engine of <strong>polars</strong> works
perfectly well—as evidenced by all of the previous examples—to get the
most out of the package you need to go <em>lazy</em>. <a href="https://pola-rs.github.io/polars-book/user-guide/lazy-api/intro.html">Lazy
execution</a> enables several benefits, but the most important is that
it improves performance. Delaying execution until the last possible
moment allows Polars to apply automatic optimization to every query.
Let’s take a quick look.</p>
<p>To create a so-called “<a href="https://rpolars.github.io/reference/LazyFrame_class.html">LazyFrame</a>”
from an existing object in memory, we can invoke the <code>lazy()</code>
constructor.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>ldat <span class="ot">=</span> dat<span class="sc">$</span><span class="fu">lazy</span>()</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>ldat</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;polars LazyFrame naive plan: (run ldf$describe_optimized_plan() to see the optimized plan)&quot;</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="co">#&gt;   DF [&quot;mpg&quot;, &quot;cyl&quot;, &quot;disp&quot;, &quot;hp&quot;]; PROJECT */11 COLUMNS; SELECTION: &quot;None&quot;</span></span></code></pre></div>
<p>Now consider what happens when we run our subsetting query from
earlier on this LazyFrame.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>subset_query <span class="ot">=</span> ldat<span class="sc">$</span><span class="fu">filter</span>(</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>    pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;cyl&quot;</span>)<span class="sc">==</span><span class="dv">6</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>)<span class="sc">$</span><span class="fu">select</span>(</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>    pl<span class="sc">$</span><span class="fu">col</span>(<span class="fu">c</span>(<span class="st">&quot;mpg&quot;</span>, <span class="st">&quot;hp&quot;</span>, <span class="st">&quot;cyl&quot;</span>))</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>)</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>  </span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>subset_query</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a><span class="co">#&gt; [1] &quot;polars LazyFrame naive plan: (run ldf$describe_optimized_plan() to see the optimized plan)&quot;</span></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a><span class="co">#&gt;    SELECT [col(&quot;mpg&quot;), col(&quot;hp&quot;), col(&quot;cyl&quot;)] FROM</span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a><span class="co">#&gt;     FILTER [(col(&quot;cyl&quot;)) == (6f64)] FROM</span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a><span class="co">#&gt;       DF [&quot;mpg&quot;, &quot;cyl&quot;, &quot;disp&quot;, &quot;hp&quot;]; PROJECT */11 COLUMNS; SELECTION: &quot;None&quot;</span></span></code></pre></div>
<p>Right now we only have a tree of instructions. But underneath the
hood, Polars has already worked out a more optimized version of the
query. We can view this optimized plan this by requesting it.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>subset_query<span class="sc">$</span><span class="fu">describe_optimized_plan</span>()</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="co">#&gt;   FAST_PROJECT: [mpg, hp, cyl]</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="co">#&gt;     DF [&quot;mpg&quot;, &quot;cyl&quot;, &quot;disp&quot;, &quot;hp&quot;]; PROJECT 3/11 COLUMNS; SELECTION: &quot;[(col(\&quot;cyl\&quot;)) == (6f64)]&quot;</span></span></code></pre></div>
<p>Here we see a simple, but surprisingly effective component in query
optimization: <em>projection</em>. Changing the order in which our
subsetting operations occurs—in this case, subsetting on columns
first—reduces the memory overhead of the overall query and leads to a
downstream speedup. Of course, you would hardly notice a difference for
this small dataset. But the same principles carry over to much bigger
datasets and more complex queries.</p>
<p>To actually execute the plan, we just need to invoke the
<code>collect()</code> method. This should feel very familiar if you
have previously used other lazy execution engines like those provided by
<strong>arrow</strong> or <strong>dbplyr</strong>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>subset_query<span class="sc">$</span><span class="fu">collect</span>()</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="co">#&gt; polars DataFrame: shape: (7, 3)</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a><span class="co">#&gt; ┌──────┬───────┬─────┐</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ hp    ┆ cyl │</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ ---   ┆ --- │</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64   ┆ f64 │</span></span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═══════╪═════╡</span></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 110.0 ┆ 6.0 │</span></span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 110.0 ┆ 6.0 │</span></span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 110.0 ┆ 6.0 │</span></span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a><span class="co">#&gt; │ 18.1 ┆ 105.0 ┆ 6.0 │</span></span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a><span class="co">#&gt; │ 19.2 ┆ 123.0 ┆ 6.0 │</span></span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a><span class="co">#&gt; │ 17.8 ┆ 123.0 ┆ 6.0 │</span></span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a><span class="co">#&gt; │ 19.7 ┆ 175.0 ┆ 6.0 │</span></span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a><span class="co">#&gt; └──────┴───────┴─────┘</span></span></code></pre></div>
<h2 id="data-import">Data import</h2>
<p><strong>polars</strong> supports data import of both CSV and Parquet
files formats. Here we demonstrate using the <code>airquality</code>
dataset that also comes bundled with base R.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="fu">write.csv</span>(airquality, <span class="st">&quot;airquality.csv&quot;</span>)</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>pl<span class="sc">$</span><span class="fu">read_csv</span>(<span class="st">&quot;airquality.csv&quot;</span>)</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a><span class="co">#&gt; polars DataFrame: shape: (153, 7)</span></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a><span class="co">#&gt; ┌─────┬───────┬─────────┬──────┬──────┬───────┬─────┐</span></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a><span class="co">#&gt; │     ┆ Ozone ┆ Solar.R ┆ Wind ┆ Temp ┆ Month ┆ Day │</span></span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a><span class="co">#&gt; │ --- ┆ ---   ┆ ---     ┆ ---  ┆ ---  ┆ ---   ┆ --- │</span></span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a><span class="co">#&gt; │ i64 ┆ str   ┆ str     ┆ f64  ┆ i64  ┆ i64   ┆ i64 │</span></span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a><span class="co">#&gt; ╞═════╪═══════╪═════════╪══════╪══════╪═══════╪═════╡</span></span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a><span class="co">#&gt; │ 1   ┆ 41    ┆ 190     ┆ 7.4  ┆ 67   ┆ 5     ┆ 1   │</span></span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a><span class="co">#&gt; │ 2   ┆ 36    ┆ 118     ┆ 8.0  ┆ 72   ┆ 5     ┆ 2   │</span></span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a><span class="co">#&gt; │ 3   ┆ 12    ┆ 149     ┆ 12.6 ┆ 74   ┆ 5     ┆ 3   │</span></span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a><span class="co">#&gt; │ 4   ┆ 18    ┆ 313     ┆ 11.5 ┆ 62   ┆ 5     ┆ 4   │</span></span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a><span class="co">#&gt; │ ... ┆ ...   ┆ ...     ┆ ...  ┆ ...  ┆ ...   ┆ ... │</span></span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a><span class="co">#&gt; │ 150 ┆ NA    ┆ 145     ┆ 13.2 ┆ 77   ┆ 9     ┆ 27  │</span></span>
<span id="cb24-16"><a href="#cb24-16" tabindex="-1"></a><span class="co">#&gt; │ 151 ┆ 14    ┆ 191     ┆ 14.3 ┆ 75   ┆ 9     ┆ 28  │</span></span>
<span id="cb24-17"><a href="#cb24-17" tabindex="-1"></a><span class="co">#&gt; │ 152 ┆ 18    ┆ 131     ┆ 8.0  ┆ 76   ┆ 9     ┆ 29  │</span></span>
<span id="cb24-18"><a href="#cb24-18" tabindex="-1"></a><span class="co">#&gt; │ 153 ┆ 20    ┆ 223     ┆ 11.5 ┆ 68   ┆ 9     ┆ 30  │</span></span>
<span id="cb24-19"><a href="#cb24-19" tabindex="-1"></a><span class="co">#&gt; └─────┴───────┴─────────┴──────┴──────┴───────┴─────┘</span></span></code></pre></div>
<p>Again, however, the package works best if we take the lazy
approach.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>pl<span class="sc">$</span><span class="fu">lazy_csv_reader</span>(<span class="st">&quot;airquality.csv&quot;</span>)</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;polars LazyFrame naive plan: (run ldf$describe_optimized_plan() to see the optimized plan)&quot;</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="co">#&gt;   CSV SCAN airquality.csv</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a><span class="co">#&gt;   PROJECT */7 COLUMNS</span></span></code></pre></div>
<p>We could obviously append a set of query operators to the above
LazyFrame and then collect the results. However, this workflow is even
better suited to Parquet files, since we can leverage their efficient
storage format on disk. Let’s see an example.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="fu">library</span>(arrow)</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="fu">write_parquet</span>(airquality, <span class="st">&quot;airquality.parquet&quot;</span>)</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="co"># aq = read_parquet(&quot;airquality.parquet) # eager version (okay)</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>aq <span class="ot">=</span> <span class="fu">scan_parquet</span>(<span class="st">&quot;airquality.parquet&quot;</span>)  <span class="co"># lazy version (better)</span></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>aq<span class="sc">$</span><span class="fu">filter</span>(</span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;Month&quot;</span>) <span class="sc">&lt;=</span> <span class="dv">6</span></span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>)<span class="sc">$</span><span class="fu">groupby</span>(</span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a>  <span class="st">&quot;Month&quot;</span></span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a>)<span class="sc">$</span><span class="fu">agg</span>(</span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="fu">c</span>(<span class="st">&quot;Ozone&quot;</span>, <span class="st">&quot;Temp&quot;</span>))<span class="sc">$</span><span class="fu">mean</span>()</span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a>)<span class="sc">$</span><span class="fu">collect</span>()</span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a><span class="co">#&gt; polars DataFrame: shape: (2, 3)</span></span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a><span class="co">#&gt; ┌───────┬───────────┬───────────┐</span></span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a><span class="co">#&gt; │ Month ┆ Ozone     ┆ Temp      │</span></span>
<span id="cb26-18"><a href="#cb26-18" tabindex="-1"></a><span class="co">#&gt; │ ---   ┆ ---       ┆ ---       │</span></span>
<span id="cb26-19"><a href="#cb26-19" tabindex="-1"></a><span class="co">#&gt; │ i32   ┆ f64       ┆ f64       │</span></span>
<span id="cb26-20"><a href="#cb26-20" tabindex="-1"></a><span class="co">#&gt; ╞═══════╪═══════════╪═══════════╡</span></span>
<span id="cb26-21"><a href="#cb26-21" tabindex="-1"></a><span class="co">#&gt; │ 6     ┆ 29.444444 ┆ 79.1      │</span></span>
<span id="cb26-22"><a href="#cb26-22" tabindex="-1"></a><span class="co">#&gt; │ 5     ┆ 23.615385 ┆ 65.548387 │</span></span>
<span id="cb26-23"><a href="#cb26-23" tabindex="-1"></a><span class="co">#&gt; └───────┴───────────┴───────────┘</span></span></code></pre></div>
<p>Finally, can read/scan multiple files in the same directory through
pattern globbing. However, please note that partition-aware scanning is
not yet supported out of the box (e.g., Hive-style partitioned
datasets). Follow <a href="https://github.com/pola-rs/polars/issues/4347">this issue</a> for
more details about when this will be resolved.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;airquality-ds&quot;</span>)</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="fu">write_dataset</span>(airquality, <span class="st">&quot;airquality-ds&quot;</span>, <span class="at">partitioning =</span> <span class="st">&quot;Month&quot;</span>)</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a><span class="co"># Use pattern globbing to scan all parquet files in the folder</span></span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>aq2 <span class="ot">=</span> <span class="fu">scan_parquet</span>(<span class="st">&quot;airquality-ds/*/*.parquet&quot;</span>)</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a><span class="co"># Just print the first two rows. But note that the Month column</span></span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a><span class="co"># (which we used for partitioning) is missing.</span></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a>aq2<span class="sc">$</span><span class="fu">limit</span>(<span class="dv">2</span>)<span class="sc">$</span><span class="fu">collect</span>()</span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a><span class="co">#&gt; polars DataFrame: shape: (2, 5)</span></span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a><span class="co">#&gt; ┌───────┬─────────┬──────┬──────┬─────┐</span></span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a><span class="co">#&gt; │ Ozone ┆ Solar.R ┆ Wind ┆ Temp ┆ Day │</span></span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a><span class="co">#&gt; │ ---   ┆ ---     ┆ ---  ┆ ---  ┆ --- │</span></span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a><span class="co">#&gt; │ i32   ┆ i32     ┆ f64  ┆ i32  ┆ i32 │</span></span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a><span class="co">#&gt; ╞═══════╪═════════╪══════╪══════╪═════╡</span></span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a><span class="co">#&gt; │ 41    ┆ 190     ┆ 7.4  ┆ 67   ┆ 1   │</span></span>
<span id="cb27-17"><a href="#cb27-17" tabindex="-1"></a><span class="co">#&gt; │ 36    ┆ 118     ┆ 8.0  ┆ 72   ┆ 2   │</span></span>
<span id="cb27-18"><a href="#cb27-18" tabindex="-1"></a><span class="co">#&gt; └───────┴─────────┴──────┴──────┴─────┘</span></span></code></pre></div>
<p>Before continuing, don’t forget to clean up by removing the newly
created temp files and directory on disk.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">c</span>(<span class="st">&quot;airquality.csv&quot;</span>, <span class="st">&quot;airquality.parquet&quot;</span>))</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a><span class="co">#&gt; [1] TRUE TRUE</span></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">&quot;airquality-ds&quot;</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<h2 id="execute-r-functions-within-a-polars-query">Execute R functions
within a Polars query</h2>
<p>It is possible to mix R code with Polars by passing R functions to
<strong>polars</strong>. This can unlock a lot of flexibility, but note
that it can inhibit performance. R functions are typically slower, so we
recommend using native Polars functions and expressions wherever
possible.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>pl<span class="sc">$</span><span class="fu">DataFrame</span>(iris)<span class="sc">$</span><span class="fu">select</span>(</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;Sepal.Length&quot;</span>)<span class="sc">$</span><span class="fu">map</span>(\(s) { <span class="co"># map with a R function</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>    x <span class="ot">=</span> s<span class="sc">$</span><span class="fu">to_r_vector</span>() <span class="co"># convert from Polars Series to a native R vector</span></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>    x[x<span class="sc">&gt;=</span><span class="dv">5</span>] <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>    x[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>] <span class="co"># if return is R vector, it will automatically be converted to Polars Series again</span></span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>    })</span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>)<span class="sc">$</span><span class="fu">as_data_frame</span>()</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a><span class="co">#&gt;    Sepal.Length</span></span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a><span class="co">#&gt; 1          10.0</span></span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a><span class="co">#&gt; 2           4.9</span></span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a><span class="co">#&gt; 3           4.7</span></span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a><span class="co">#&gt; 4           4.6</span></span>
<span id="cb29-13"><a href="#cb29-13" tabindex="-1"></a><span class="co">#&gt; 5          10.0</span></span>
<span id="cb29-14"><a href="#cb29-14" tabindex="-1"></a><span class="co">#&gt; 6          10.0</span></span>
<span id="cb29-15"><a href="#cb29-15" tabindex="-1"></a><span class="co">#&gt; 7           4.6</span></span>
<span id="cb29-16"><a href="#cb29-16" tabindex="-1"></a><span class="co">#&gt; 8          10.0</span></span>
<span id="cb29-17"><a href="#cb29-17" tabindex="-1"></a><span class="co">#&gt; 9           4.4</span></span>
<span id="cb29-18"><a href="#cb29-18" tabindex="-1"></a><span class="co">#&gt; 10          4.9</span></span></code></pre></div>
<h2 id="data-types">Data types</h2>
<p>Polars is <a href="https://en.wikipedia.org/wiki/Strong_and_weak_typing">strongly
typed</a> and new types can be created with the <code>dtypes</code>
constructor. For example:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>pl<span class="sc">$</span>dtypes<span class="sc">$</span>Float64</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a><span class="co">#&gt; DataType: Float64</span></span></code></pre></div>
<p>The full list of valid Polars types can be found by typing
<code>pl$dtypes</code> into your R console. These include
<em>Boolean</em>, <em>Float32(64)</em>, <em>Int32(64)</em>,
<em>Utf8</em>, <em>Categorical</em>, <em>Date</em>, etc. Note that some
type names differ from what they are called in R (e.g., <em>Boolean</em>
in Polars is equivalent to <code>logical()</code> in R). This might
occasionally require you to look up a specific type. But the good news
is that <strong>polars</strong> generally does a good job of inferring
types automatically.</p>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>Similar to how (most) <strong>data.table</strong>
operations are limited to objects of class <code>data.table</code>, we
can only perform polars operations on objects that have been converted
to an appropriate <strong>polars</strong> class. Later on, we’ll see how
to read data from disk directly in Polars format.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>

</body>
</html>
