patrick::with_parameters_test_that(
  "data types print",
  .cases = {
    # nolint start: line_length_linter
    tibble::tribble(
      ~.test_name, ~object,
      "Int8", pl$Int8,
      "Int16", pl$Int16,
      "Int32", pl$Int32,
      "Int64", pl$Int64,
      "UInt8", pl$UInt8,
      "UInt16", pl$UInt16,
      "UInt32", pl$UInt32,
      "UInt64", pl$UInt64,
      "Float32", pl$Float32,
      "Float64", pl$Float64,
      "Boolean", pl$Boolean,
      "String", pl$String,
      "Binary", pl$Binary,
      "Date", pl$Date,
      "Time", pl$Time,
      "Null", pl$Null,
      "Decimal()", pl$Decimal(),
      "Decimal(2, 2)", pl$Decimal(2, 2),
      "Datetime('ms', NULL)", pl$Datetime("ms", NULL),
      "Datetime('ns', 'UTC')", pl$Datetime("ns", "UTC"),
      "Datetime('us', 'UTC')", pl$Datetime("us", "UTC"),
      "Duration('ms')", pl$Duration("ms"),
      "Duration('us')", pl$Duration("us"),
      "List(String)", pl$List(pl$String),
      "List(List(Datetime('ms', 'UTC')))", pl$List(pl$List(pl$Datetime("ms", "UTC"))),
      "Array(String, 2)", pl$Array(pl$String, 2),
      "Array(String, c(2, 2))", pl$Array(pl$String, c(2, 2)),
      "Array(List(Array(String, 2)), c(2, 2))", pl$Array(pl$List(pl$Array(pl$String, 2)), c(2, 2)),
      "Struct(a = Int32, b = String)", pl$Struct(a = pl$Int32, b = pl$String),
      "Struct(a = Struct(b = Int32), c = String)", pl$Struct(a = pl$Struct(b = pl$Int32), c = pl$String),
      "Struct(Int8, ` ` = String, \"`'\"\" = Int16))", pl$Struct(pl$Int8, ` ` = pl$String, "`'\"" = pl$Int16),
      "Categorical()", pl$Categorical(),
      "Enum(c('a', 'b', 'c'))", pl$Enum(c("a", "b", "c")),
    )
    # nolint end
  },
  code = {
    expect_snapshot(print(class(object)))
    expect_snapshot(print(object))
  }
)

patrick::with_parameters_test_that(
  "Enum construct error",
  .cases = {
    tibble::tribble(
      ~.test_name, ~categories,
      "non-character", 1:5,
      "NA", c("a", NA_character_),
      "duplicated", c("c", "b", "a", "b", "a"),
    )
  },
  code = {
    expect_snapshot(pl$Enum(categories), error = TRUE)
  }
)

patrick::with_parameters_test_that(
  "Enum union works",
  .cases = {
    tibble::tribble(
      ~.test_name, ~input, ~expected_output,
      "a", pl$Enum("a"), pl$Enum(c("b", "d", "a")),
      "b", pl$Enum("b"), pl$Enum(c("b", "d")),
      "c, d", pl$Enum(c("c", "d")), pl$Enum(c("b", "d", "c")),
    )
  },
  code = {
    expect_equal(pl$Enum(c("b", "d"))$union(input), expected_output)
    expect_equal(input$union(input), input)
  }
)

test_that("Enum union error", {
  expect_error(pl$Enum("a")$union(1), "`other` must be a polars data type, not the number 1")
  expect_error(pl$Enum("a")$union(pl$Int32), "`other` must be a Enum data type")
})

test_that("Categorical order deprecation", {
  expect_deprecated(pl$Categorical("lexical"))
  expect_deprecated(pl$Categorical("physical"))
})

test_that("Decimal deprecation", {
  expect_snapshot(pl$Decimal(NULL, NULL))
})

patrick::with_parameters_test_that(
  "invalid decimal (precision = {precision}, scale = {scale})",
  .cases = {
    tibble::tribble(
      ~precision, ~scale,
      0, 0,
      -1, 0,
      1, -1,
      39, 40,
      38, 39,
      39, 1,
    )
  },
  code = {
    expect_snapshot(pl$Decimal(precision, scale), error = TRUE)
  }
)
